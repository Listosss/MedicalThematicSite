{"ast":null,"code":"import React,{createContext,useEffect,useState}from'react';import{useNavigate}from'react-router-dom';import{jsx as _jsx}from\"react/jsx-runtime\";export const AuthContext=/*#__PURE__*/createContext();export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const navigate=useNavigate();const loadUserFromStorage=()=>{try{const userData=localStorage.getItem(\"currentUser\");return userData?JSON.parse(userData):null;}catch(error){console.error(\"Error loading user from localStorage:\",error);return null;}};useEffect(()=>{const loadedUser=loadUserFromStorage();if(loadedUser)setUser(loadedUser);},[]);const login=(username,pass)=>{const users=JSON.parse(localStorage.getItem(\"users\")||\"[]\");if(users.length===0){alert(\"No registered users found. Please check your username or password.\");return;}const thisUser=users.find(user=>String(user.password)===String(pass)&&user.name===username);if(thisUser){setUser(thisUser);localStorage.setItem(\"currentUser\",JSON.stringify(thisUser));navigate('/account');}else alert(\"Invalid username or password. Please try again.\");};const checkNameUniqueness=username=>{const users=JSON.parse(localStorage.getItem(\"users\")||\"[]\");return!users.some(user=>user.name===username);};const register=data=>{const users=JSON.parse(localStorage.getItem(\"users\")||\"[]\");users.push(data);localStorage.setItem(\"users\",JSON.stringify(users));navigate('/login');};const logout=()=>{const users=JSON.parse(localStorage.getItem(\"users\")||\"[]\");console.log(users);const newUsers=[...users.filter(this_user=>this_user.name!==user.name),user];localStorage.clear();localStorage.setItem(\"users\",JSON.stringify(newUsers));setUser(null);navigate(\"/\");};const updateUser=updatedFields=>{const updatedUser={...user,...updatedFields};setUser(updatedUser);localStorage.setItem(\"currentUser\",JSON.stringify(updatedUser));};const saveArticle=_ref2=>{let{uid,title}=_ref2;if(!user)return;const updatedFields={savedArticles:[...(user.savedArticles||[]),{uid,title}]};updateUser(updatedFields);};const deleteSavedArticle=_ref3=>{let{uid}=_ref3;if(!user)return;const updatedFields={savedArticles:user.savedArticles.filter(article=>String(article.uid)!==String(uid))};updateUser(updatedFields);};const rateArticle=(uid,rating)=>{var _user$ratedArticles;if(!user)return;const ratedArticles=(user===null||user===void 0?void 0:(_user$ratedArticles=user.ratedArticles)===null||_user$ratedArticles===void 0?void 0:_user$ratedArticles.filter(article=>article.uid!==uid))||[];ratedArticles.push({uid,rating});updateUser({ratedArticles});};const updateAvatar=newAvatar=>{if(!user)return;const avatar=newAvatar;updateUser({avatar});};const authContextValue={user,login,logout,register,checkNameUniqueness,saveArticle,deleteSavedArticle,updateAvatar,rateArticle};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:authContextValue,children:children});};","map":{"version":3,"names":["React","createContext","useEffect","useState","useNavigate","jsx","_jsx","AuthContext","AuthProvider","_ref","children","user","setUser","navigate","loadUserFromStorage","userData","localStorage","getItem","JSON","parse","error","console","loadedUser","login","username","pass","users","length","alert","thisUser","find","String","password","name","setItem","stringify","checkNameUniqueness","some","register","data","push","logout","log","newUsers","filter","this_user","clear","updateUser","updatedFields","updatedUser","saveArticle","_ref2","uid","title","savedArticles","deleteSavedArticle","_ref3","article","rateArticle","rating","_user$ratedArticles","ratedArticles","updateAvatar","newAvatar","avatar","authContextValue","Provider","value"],"sources":["C:/Users/Админ/Documents/Svarchik/ТПП/kurs/portal/frontend/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useEffect, useState } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nexport const AuthContext = createContext();\r\n\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(null);\r\n  const navigate = useNavigate();\r\n\r\n  const loadUserFromStorage = () => {\r\n    try {\r\n      const userData = localStorage.getItem(\"currentUser\");\r\n      return userData ? JSON.parse(userData) : null;\r\n    } catch (error) {\r\n      console.error(\"Error loading user from localStorage:\", error);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const loadedUser = loadUserFromStorage();\r\n    if (loadedUser) setUser(loadedUser)\r\n  }, [])\r\n\r\n  const login = (username, pass) => {\r\n    const users = JSON.parse(localStorage.getItem(\"users\") || \"[]\");\r\n\r\n    if (users.length === 0) {\r\n      alert(\"No registered users found. Please check your username or password.\")\r\n      return;\r\n    }\r\n    const thisUser = users.find(user => String(user.password) === String(pass) && user.name === username)\r\n    if (thisUser) {\r\n      setUser(thisUser);\r\n      localStorage.setItem(\"currentUser\", JSON.stringify(thisUser));\r\n      navigate('/account');\r\n    }\r\n    else\r\n      alert(\"Invalid username or password. Please try again.\")\r\n  }\r\n\r\n  const checkNameUniqueness = (username) => {\r\n    const users = JSON.parse(localStorage.getItem(\"users\") || \"[]\");\r\n    return !users.some(user => user.name === username);\r\n  }\r\n\r\n  const register = (data) => {\r\n    const users = JSON.parse(localStorage.getItem(\"users\") || \"[]\");\r\n    users.push(data)\r\n\r\n    localStorage.setItem(\"users\", JSON.stringify(users));\r\n    navigate('/login');\r\n  };\r\n\r\n  const logout = () => {\r\n    const users = JSON.parse(localStorage.getItem(\"users\") || \"[]\");\r\n    console.log(users)\r\n    const newUsers = [...users.filter(this_user => this_user.name !== user.name), user];\r\n    localStorage.clear();\r\n    localStorage.setItem(\"users\", JSON.stringify(newUsers))\r\n\r\n    setUser(null);\r\n    navigate(\"/\")\r\n  };\r\n\r\n\r\n  const updateUser = (updatedFields) => {\r\n    const updatedUser = { ...user, ...updatedFields }\r\n    setUser(updatedUser);\r\n    localStorage.setItem(\"currentUser\", JSON.stringify(updatedUser));\r\n  }\r\n\r\n  const saveArticle = ({ uid, title }) => {\r\n    if (!user) return\r\n\r\n    const updatedFields = { savedArticles: [...(user.savedArticles || []), { uid, title }] }\r\n    updateUser(updatedFields)\r\n  }\r\n\r\n  const deleteSavedArticle = ({ uid }) => {\r\n    if (!user) return;\r\n\r\n    const updatedFields = { savedArticles: user.savedArticles.filter(article => String(article.uid) !== String(uid)) }\r\n    updateUser(updatedFields)\r\n  }\r\n\r\n  const rateArticle = (uid, rating) => {\r\n    if (!user) return;\r\n    const ratedArticles = user?.ratedArticles?.filter(article => article.uid !== uid) || [];\r\n    ratedArticles.push({ uid, rating })\r\n    updateUser({ ratedArticles })\r\n  }\r\n\r\n  const updateAvatar = (newAvatar) => {\r\n    if (!user) return;\r\n\r\n    const avatar = newAvatar;\r\n    updateUser({ avatar })\r\n  }\r\n\r\n\r\n  const authContextValue = {\r\n    user,\r\n    login,\r\n    logout,\r\n    register,\r\n    checkNameUniqueness,\r\n    saveArticle,\r\n    deleteSavedArticle,\r\n    updateAvatar,\r\n    rateArticle,\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={authContextValue}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  )\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}