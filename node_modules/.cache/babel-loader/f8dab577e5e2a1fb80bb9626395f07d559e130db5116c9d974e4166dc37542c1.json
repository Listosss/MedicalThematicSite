{"ast":null,"code":"import React,{useContext,useEffect,useState}from'react';import'./ArticlePage.css';import{NavLink,useParams}from'react-router-dom';import Comments from'../../components/Comments/Comments';import{StarRating}from'../../components/StarRating/StarRating';import'font-awesome/css/font-awesome.min.css';import{AuthContext}from'../../context/AuthContext';import{ModalWindow}from'../../components/ModalWindow/ModalWindow';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function SaveArticle(_ref){let{uid,title}=_ref;const{user,saveArticle,deleteSavedArticle}=useContext(AuthContext);const[isSaved,setIsSaved]=useState(false);const[modalIsOpened,setIsModalOpened]=useState(false);useEffect(()=>{if(!user)return;if(user!==null&&user!==void 0&&user.savedArticles){setIsSaved(user.savedArticles.some(savedArticle=>savedArticle.uid===uid));}},[uid]);const handleClick=()=>{if(!user){setIsModalOpened(true);return;}if(!isSaved){saveArticle({uid,title});}else{deleteSavedArticle({uid});}setIsSaved(!isSaved);};return/*#__PURE__*/_jsxs(_Fragment,{children:[modalIsOpened&&/*#__PURE__*/_jsxs(ModalWindow,{onClose:()=>setIsModalOpened(false),children:[/*#__PURE__*/_jsx(\"p\",{children:\"To interact with article you need an account\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal_links_div\",children:[/*#__PURE__*/_jsx(NavLink,{to:'/login',children:\"Log in\"}),/*#__PURE__*/_jsx(NavLink,{to:'/register',children:\"Sign up\"})]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleClick,className:\"save_article_btn\",children:/*#__PURE__*/_jsx(\"i\",{className:`${isSaved?'fa-solid':'fa-regular'} fa-bookmark`})})]});}export function ArticlePage(){const{uid}=useParams();const[data,setData]=useState(null);const[isLoading,setIsLoading]=useState(false);const getAllInfo=async()=>{try{var _xmlDoc$querySelector,_xmlDoc$querySelector2,_xmlDoc$querySelector3,_xmlDoc$querySelector4,_xmlDoc$querySelector5;setIsLoading(true);const response=await fetch(`https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=pubmed&id=${uid}&retmode=xml`);const xmlText=await response.text();const parser=new DOMParser();const xmlDoc=parser.parseFromString(xmlText,\"application/xml\");const meshTerms=Array.from(xmlDoc.querySelectorAll(\"MeshHeading > DescriptorName\")).map(term=>term.textContent)||\"No MeSH terms found\";const title=((_xmlDoc$querySelector=xmlDoc.querySelector(\"ArticleTitle\"))===null||_xmlDoc$querySelector===void 0?void 0:_xmlDoc$querySelector.textContent)||\"No title found\";const abstract=((_xmlDoc$querySelector2=xmlDoc.querySelector(\"AbstractText\"))===null||_xmlDoc$querySelector2===void 0?void 0:_xmlDoc$querySelector2.textContent)||\"No abstract available\";const authors=Array.from(xmlDoc.querySelectorAll(\"Author > LastName\")).map(author=>author.textContent).join(\", \")||\"No authors found\";const pubDateYear=((_xmlDoc$querySelector3=xmlDoc.querySelector(\"PubDate > Year\"))===null||_xmlDoc$querySelector3===void 0?void 0:_xmlDoc$querySelector3.textContent)||\"\";const pubDateMonth=((_xmlDoc$querySelector4=xmlDoc.querySelector(\"PubDate > Month\"))===null||_xmlDoc$querySelector4===void 0?void 0:_xmlDoc$querySelector4.textContent)||\"\";const pubDateDay=((_xmlDoc$querySelector5=xmlDoc.querySelector(\"PubDate > Day\"))===null||_xmlDoc$querySelector5===void 0?void 0:_xmlDoc$querySelector5.textContent)||\"\";setData({title:title,abstract:abstract,authors:`Authors:  ${authors}`,pubdt:`${pubDateDay} ${pubDateMonth} ${pubDateYear}`,terms:[...meshTerms.slice(0,5)]});setIsLoading(false);}catch(error){console.log('Failed to fetch article: ',error);}};useEffect(()=>{getAllInfo();},[]);return/*#__PURE__*/_jsxs(\"div\",{className:\"page_wrapper\",children:[!isLoading&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"article_title\",children:data===null||data===void 0?void 0:data.title}),/*#__PURE__*/_jsx(\"div\",{className:\"categories_div_article\",children:data!==null&&data!==void 0&&data.terms?data.terms.map((category,i)=>/*#__PURE__*/_jsx(\"p\",{className:\"article_category\",children:category},i)):/*#__PURE__*/_jsx(\"p\",{})}),/*#__PURE__*/_jsx(SaveArticle,{uid:uid,title:data===null||data===void 0?void 0:data.title}),/*#__PURE__*/_jsx(\"p\",{className:\"article_pubDate_text\",children:data===null||data===void 0?void 0:data.pubdt}),/*#__PURE__*/_jsx(\"p\",{className:\"article_authors_text\",children:data===null||data===void 0?void 0:data.authors}),/*#__PURE__*/_jsx(\"p\",{className:\"article_text\",children:data===null||data===void 0?void 0:data.abstract}),/*#__PURE__*/_jsx(StarRating,{articleId:uid}),/*#__PURE__*/_jsx(Comments,{uid:uid})]}),isLoading&&/*#__PURE__*/_jsx(\"div\",{className:\"loading_div\",children:/*#__PURE__*/_jsx(\"div\",{className:\"spinner-border text-success\",role:\"status\",children:/*#__PURE__*/_jsx(\"span\",{className:\"visually-hidden\",children:\"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430...\"})})})]});}","map":{"version":3,"names":["React","useContext","useEffect","useState","NavLink","useParams","Comments","StarRating","AuthContext","ModalWindow","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","SaveArticle","_ref","uid","title","user","saveArticle","deleteSavedArticle","isSaved","setIsSaved","modalIsOpened","setIsModalOpened","savedArticles","some","savedArticle","handleClick","children","onClose","className","to","onClick","ArticlePage","data","setData","isLoading","setIsLoading","getAllInfo","_xmlDoc$querySelector","_xmlDoc$querySelector2","_xmlDoc$querySelector3","_xmlDoc$querySelector4","_xmlDoc$querySelector5","response","fetch","xmlText","text","parser","DOMParser","xmlDoc","parseFromString","meshTerms","Array","from","querySelectorAll","map","term","textContent","querySelector","abstract","authors","author","join","pubDateYear","pubDateMonth","pubDateDay","pubdt","terms","slice","error","console","log","category","i","articleId","role"],"sources":["C:/Users/Админ/Documents/Svarchik/ТПП/kurs/portal/frontend/src/pages/ArticlePage/ArticlePage.jsx"],"sourcesContent":["import React, { useContext, useEffect, useState } from 'react'\r\nimport './ArticlePage.css'\r\nimport { NavLink, useParams } from 'react-router-dom'\r\nimport Comments from '../../components/Comments/Comments';\r\nimport { StarRating } from '../../components/StarRating/StarRating';\r\nimport 'font-awesome/css/font-awesome.min.css';\r\nimport { AuthContext } from '../../context/AuthContext';\r\nimport { ModalWindow } from '../../components/ModalWindow/ModalWindow';\r\n\r\nfunction SaveArticle({ uid, title }) {\r\n  const { user, saveArticle, deleteSavedArticle } = useContext(AuthContext)\r\n  const [isSaved, setIsSaved] = useState(false)\r\n  const [modalIsOpened, setIsModalOpened] = useState(false)\r\n\r\n  useEffect(() => {\r\n    if (!user) return\r\n    if (user?.savedArticles) {\r\n      setIsSaved(user.savedArticles.some(savedArticle => savedArticle.uid === uid))\r\n    }\r\n  }, [uid])\r\n\r\n  const handleClick = () => {\r\n    if (!user) {\r\n      setIsModalOpened(true)\r\n      return;\r\n    }\r\n    if (!isSaved) {\r\n      saveArticle({ uid, title })\r\n    }\r\n    else {\r\n      deleteSavedArticle({ uid })\r\n    }\r\n    setIsSaved(!isSaved);\r\n  }\r\n  return (\r\n    <>\r\n      {modalIsOpened && <ModalWindow onClose={() => setIsModalOpened(false)}>\r\n        <p>To interact with article you need an account</p>\r\n        <div className='modal_links_div'>\r\n          <NavLink to={'/login'} >Log in</NavLink>\r\n          <NavLink to={'/register'} >Sign up</NavLink>\r\n        </div>\r\n      </ModalWindow>}\r\n\r\n      <button onClick={handleClick} className='save_article_btn'>\r\n        <i className={`${isSaved ? 'fa-solid' : 'fa-regular'} fa-bookmark`} ></i>\r\n      </button></>\r\n  )\r\n}\r\n\r\n\r\n\r\nexport function ArticlePage() {\r\n  const { uid } = useParams();\r\n  const [data, setData] = useState(null);\r\n  const [isLoading, setIsLoading] = useState(false)\r\n\r\n  const getAllInfo = async () => {\r\n    try {\r\n      setIsLoading(true)\r\n      const response = await fetch(`https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=pubmed&id=${uid}&retmode=xml`)\r\n      const xmlText = await response.text();\r\n      const parser = new DOMParser();\r\n      const xmlDoc = parser.parseFromString(xmlText, \"application/xml\");\r\n\r\n      const meshTerms = Array.from(xmlDoc.querySelectorAll(\"MeshHeading > DescriptorName\"))\r\n        .map(term => term.textContent)\r\n        || \"No MeSH terms found\";\r\n\r\n      const title = xmlDoc.querySelector(\"ArticleTitle\")?.textContent || \"No title found\";\r\n\r\n      const abstract = xmlDoc.querySelector(\"AbstractText\")?.textContent || \"No abstract available\";\r\n      const authors = Array.from(xmlDoc.querySelectorAll(\"Author > LastName\"))\r\n        .map(author => author.textContent)\r\n        .join(\", \") || \"No authors found\";\r\n      const pubDateYear = xmlDoc.querySelector(\"PubDate > Year\")?.textContent || \"\";\r\n      const pubDateMonth = xmlDoc.querySelector(\"PubDate > Month\")?.textContent || \"\";\r\n      const pubDateDay = xmlDoc.querySelector(\"PubDate > Day\")?.textContent || \"\";\r\n      setData({ title: title, abstract: abstract, authors: `Authors:  ${authors}`, pubdt: `${pubDateDay} ${pubDateMonth} ${pubDateYear}`, terms: [...meshTerms.slice(0, 5)] })\r\n      setIsLoading(false)\r\n    }\r\n    catch (error) {\r\n      console.log('Failed to fetch article: ', error)\r\n    }\r\n  }\r\n  useEffect(() => {\r\n    getAllInfo();\r\n  }, [])\r\n\r\n  return (\r\n    <div className='page_wrapper'>\r\n      {!isLoading && <>\r\n        <h1 className='article_title'>{data?.title}</h1>\r\n        <div className='categories_div_article'>\r\n          {data?.terms ? data.terms.map((category, i) => (<p className='article_category' key={i}>{category}</p>)) : <p></p>}\r\n        </div>\r\n        <SaveArticle uid={uid} title={data?.title} />\r\n        <p className='article_pubDate_text'>{data?.pubdt}</p>\r\n        <p className='article_authors_text'>{data?.authors}</p>\r\n        <p className='article_text'>{data?.abstract}</p>\r\n        <StarRating articleId={uid} />\r\n        <Comments uid={uid} />\r\n      </>}\r\n      {isLoading && <div className='loading_div'><div className=\"spinner-border text-success\" role=\"status\" >\r\n        <span className=\"visually-hidden\">Загрузка...</span></div>\r\n      </div>}\r\n    </div>\r\n  )\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}